# Containerize Spring Boot Application

### Necessary Downloads

* IDE of your choice (recommended and used: IntelliJ Idea Ultimate Edition)
  * IntelliJ Idea:     
    * Ultimate Edition includes Docker PlugIn
    * In case of Enterprise Edition install the Docker PlugIn
  * Multiple IDEs enable to create a spring boot application via Spring Initializer
  * If the IDE of your choice does not support Spring Initializer options are given below either
* Docker Desktop
  * do not forget to log in for the team membership according to licenses 

### Create Your Spring Application

Starting off, create a spring boot application.

#### IntelliJ
For this open a new Project in IntelliJ and choose Spring 
Initializer. In case of a Web Application choose Spring Web as additional dependency, which is done in this
given example. Fill remaining fields with your desired project name, etc. and the setup of your spring application is done.

#### Other IDE
In case of an IDE not supporting Docker Initializer in its project creation process, go to
[Spring Initializr](https://start.spring.io/) and create a project based on your desires. As mentioned before
in the following example a web application is used, so the Spring Web dependency is mandatory. After you
generated the project open it inside you IDE and continue from there on.

With this, the application is already able to build and can be run at a given port (standard is 8080) under
[Localhost:8080](http://localhost:8080/). Still, there is nothing visible so far besides an autogenerated page. 
To change this we need to declare the start page. For this create an HTML file in the resources/static folder. (IntelliJ: 
File -> New -> HTML FILE). Here it is now possible to modify the start page by personal
preference. I would propose a simple Greetings for the beginning, improved by further adjustments
in the future:

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test application</title>
</head>
<body>
    <p><a>Greetings</a></p>
</body>
</html>
```

#### Addition

In case of this application, this simple page got adjusted enabling a call to the greeting
endpoint via:

```
<form action="/hello" method="GET" id="nameForm">
    <div>
        <label for="nameField">How should the app call you?</label>
        <input name="myName" id="nameField">
        <button>Greet me!</button>
    </div>
</form>
```

inside the body property of this HTML File. From this point on the start page can be entered
and the spring application can be improved. In case of this application
we want to instead look on containerizing this application. In case of further adjustments
like storage layers, etc. a docker-compose.yml can describe docker images enabling such 
improvements.

To enable docker to generate an image now first create an artifact. In case of maven chosen in the spring initializer, 
you can use the command ```mvn package```

### Create a docker image of your Spring Application

IntelliJ enables the user to obtain an overview over existing docker images and containers on your device.
Still, IntelliJ is not mandatory for containerizing your project via Docker.

#### IntelliJ
With Docker installed and the PlugIn included into ur IDE (in case of IntelliJ Ultimate automatically)
it is now possible to create a docker image of this application. For this, start your Docker Desktop
application if it is not running already. After that configure the Docker daemon by opening 
Settings -> Build, Execution, Deployment -> Docker. Here click `+` and IntelliJ should fill
all fields by itself. The successful connection between IntelliJ and Docker is visible, by 
a `Connection succesful` message at the bottom of the dialog. 

With this now docker should appear in the Services of IntelliJ at View -> Tool Windows -> Services.
Select the Docker icon and press the green arrow icon to connect to docker. From here you can
pull and push images and create container. Based on the fact of a bug, mentioned on 
[Jetbrains Forum](https://youtrack.jetbrains.com/issue/IDEA-283986/Dockerfile-group-id-1849965015-is-too-big-2097151-Use-STAR-or-PO),
which also occurred in this test application, this process of creation will be not further discussed.

Instead, a Dockerfile is used to create Docker images.
Therefore, create a File (IntelliJ: File -> New -> File) and name it "Dockerfile". Fill it with information as
given in this case for the example:

```
# base image, already existing (in case of java openjdk: + version number)
FROM openjdk:17

# port (standard port)
EXPOSE 8080

# add jar file (left: position of your jar, right: name of the image)
ADD target/HelloWorldTest-0.0.1-SNAPSHOT.jar helloWorldTest.jar

# entry, exectued as java -jar "name of image"
ENTRYPOINT ["java", "-jar", "helloWorldTest.jar"]
```

In case of IntelliJ it should be now possible to create the image of the application via the green arrow at top of the Dockerfile and configure the Docker image with name and tag.
Sadly, in case of this application the same error mentioned before occurred. Still, the option given for any IDE is usable!

#### General
Open the command line in the folder of the Docker file.

Here type: ```docker build -t "wanted name":"tag" .```

Example: ```docker build -t helloworldtest:latest .```

In this case the name of the image must be fully lowercase! Furthermore, a dot at the end of the line
is important to clarify you want to use the Dockerfile inside the local directory.

After this the docker image should be visible under the quote: ```docker images```

If this is the case, the docker image can then be run as container, with:

```docker run -p "port it should run on":"given port in Dockerfile" "name of image"```

Example:

```docker run -p 8081:8080 run helloworldtest```

Now, the docker container should be active, visible in your Docker Desktop application and in your browser
under the given port.

Congratulations, if you got to this point you have created your own spring boot web application and containerized it.